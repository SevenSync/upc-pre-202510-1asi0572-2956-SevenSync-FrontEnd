<app-toolbar></app-toolbar>

<div class="edit-pot-container">
  <div class="header-section">
    <div class="header-left">
      <button mat-icon-button class="back-button" (click)="goBack()">
        <mat-icon class="back-icon">arrow_back</mat-icon>
      </button>
      <h1 class="page-title">Editar Maceta</h1>
    </div>
  </div>

  <div class="content-wrapper">
    <mat-card class="edit-form-card">
      <mat-card-header class="form-header">
        <mat-card-title class="form-title">Información de la Maceta</mat-card-title>
        <mat-card-subtitle class="form-subtitle">
          Actualiza los detalles de tu maceta inteligente
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="form-content">
        <form [formGroup]="editForm" (ngSubmit)="onSubmit()" class="edit-form">
          <!-- Primera fila: Nombre y Tipo -->
          <div class="form-row">
            <div class="form-field">
              <label class="field-label">Nombre de la planta</label>
              <mat-form-field appearance="outline" class="full-width">
                <input
                  matInput
                  placeholder="Ingresa el nombre de tu planta"
                  formControlName="name"
                  required
                  style="padding-left:12px">
                <mat-error *ngIf="name?.hasError('required')">
                  El nombre es obligatorio
                </mat-error>
                <mat-error *ngIf="name?.hasError('minlength')">
                  El nombre debe tener al menos 2 caracteres
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-field">
              <label class="field-label">Tipo de planta</label>
              <mat-form-field appearance="outline" class="full-width">
                <mat-select formControlName="plantType" required style="padding-left:12px">
                  <mat-option *ngFor="let type of plantTypes" [value]="type.value">
                    {{ type.label }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="plantType?.hasError('required')">
                  Selecciona un tipo de planta
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Descripción -->
          <div class="form-field full-width-field">
            <label class="field-label">Descripción de la planta</label>
            <mat-form-field appearance="outline" class="full-width" >
              <textarea
                matInput
                placeholder="Describe las características de tu planta"
                formControlName="description"
                rows="3"
                required
                style="padding-left:12px">
              </textarea>
              <mat-error *ngIf="description?.hasError('required')">
                La descripción es obligatoria
              </mat-error>
              <mat-error *ngIf="description?.hasError('minlength')">
                La descripción debe tener al menos 10 caracteres
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Imagen -->
          <div class="form-field full-width-field">
            <label class="field-label">Imagen de la planta</label>
            <div
              class="image-upload-area"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
              (click)="triggerImageUpload()">

              <div *ngIf="!imagePreview" class="upload-placeholder">
                <div class="upload-icon">
                  <mat-icon>image</mat-icon>
                </div>
                <button mat-stroked-button type="button" class="upload-button">
                  <mat-icon>upload</mat-icon>
                  Elegir Imagen
                </button>
                <p class="upload-text">o arrastra y suelta una imagen aquí</p>
              </div>

              <div *ngIf="imagePreview" class="image-preview">
                <img [src]="imagePreview" alt="Preview" class="preview-image">
                <div class="image-overlay">
                  <button mat-icon-button type="button" class="change-image-btn">
                    <mat-icon>edit</mat-icon>
                  </button>
                </div>
              </div>

              <input
                type="file"
                id="imageInput"
                accept="image/*"
                (change)="onImageSelected($event)"
                style="display: none;">
            </div>
          </div>

          <!-- Segunda fila: Horario de riego y Necesidades de luz -->
          <div class="form-row">
            <div class="form-field">
              <label class="field-label">Horario de riego recomendado</label>
              <mat-form-field appearance="outline" class="full-width">
                <input
                  matInput
                  placeholder="Ej: Cada 5-7 días"
                  formControlName="wateringSchedule"
                  required
                  style="padding-left:12px">
                <mat-error *ngIf="wateringSchedule?.hasError('required')">
                  El horario de riego es obligatorio
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-field">
              <label class="field-label">Necesidades de luz</label>
              <mat-form-field appearance="outline" class="full-width">
                <mat-select formControlName="lightNeeds" required style="padding-left:12px">
                  <mat-option *ngFor="let light of lightNeedsOptions" [value]="light.value">
                    {{ light.label }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="lightNeeds?.hasError('required')">
                  Selecciona las necesidades de luz
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Tercera fila: Temperatura y Humedad -->
          <div class="form-row">
            <div class="form-field">
              <label class="field-label">Temperatura óptima</label>
              <mat-form-field appearance="outline" class="full-width">
                <input
                  matInput
                  placeholder="Ej: 18-27°C"
                  formControlName="optimalTemperature"
                  required
                  style="padding-left:12px">
                <mat-error *ngIf="optimalTemperature?.hasError('required')">
                  La temperatura óptima es obligatoria
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-field">
              <label class="field-label">Humedad óptima</label>
              <mat-form-field appearance="outline" class="full-width">
                <input
                  matInput
                  placeholder="Ej: 40-60%"
                  formControlName="optimalHumidity"
                  required
                  style="padding-left:12px">
              </mat-form-field>
            </div>
          </div>
        </form>
      </mat-card-content>

      <mat-card-actions class="form-actions">
        <button mat-stroked-button type="button" class="cancel-button" (click)="onCancel()">
          Cancelar
        </button>
        <button
          mat-raised-button
          type="submit"
          class="save-button"
          [disabled]="editForm.invalid"
          (click)="onSubmit()">
          <mat-icon>check</mat-icon>
          Editar Maceta
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
