<app-toolbar></app-toolbar>

<div class="profile-container">
  <div class="header-section">
    <h1 class="page-title">{{ 'PROFILE.TITLE' | translate }}</h1>
    <p class="subtitle">{{ 'PROFILE.SUBTITLE' | translate }}</p>
  </div>

  <div class="content-wrapper" *ngIf="profile; else loading">
    <div class="profile-layout">
      <!-- Sidebar con información principal -->
      <div class="profile-sidebar">
        <div class="profile-card">
          <div class="avatar-section">
            <div class="avatar">
              <img src="default-avatar.png" alt="Avatar" class="avatar-image">
              <button mat-fab mini color="primary" class="avatar-edit">
                <mat-icon>edit</mat-icon>
              </button>
            </div>
            <h2 class="profile-name">{{ profile.fullName }}</h2>
            <p class="profile-email">{{ email }}</p>
          </div>

          <div class="profile-stats">
            <div class="stat-item">
              <mat-icon class="stat-icon">person</mat-icon>
              <div class="stat-info">
                <span class="stat-label">{{ 'PROFILE.STATS.MEMBER_SINCE' | translate }}</span>
                <span class="stat-value">Mayo 2023</span>
              </div>
            </div>

            <div class="stat-item">
              <mat-icon class="stat-icon">eco</mat-icon>
              <div class="stat-info">
                <span class="stat-label">{{ 'PROFILE.STATS.ACTIVE_POTS' | translate }}</span>
                <span class="stat-value">4 macetas</span>
              </div>
            </div>
          </div>

          <div class="membership-info">
            <h3>{{ 'PROFILE.MEMBERSHIP.TITLE' | translate }}</h3>
            <div class="membership-badge">
              <mat-icon class="membership-icon">{{ isPremiumUser ? 'crown' : 'eco' }}</mat-icon>
              <span>{{ isPremiumUser ? ('PROFILE.MEMBERSHIP.PREMIUM' | translate) : ('PROFILE.MEMBERSHIP.FREE' | translate) }}</span>
            </div>
            <button *ngIf="!isPremiumUser"
                    mat-raised-button
                    color="primary"
                    class="upgrade-button"
                    routerLink="/membership">
              <mat-icon>crown</mat-icon>
              {{ 'PROFILE.ACTIONS.UPGRADE' | translate }}
            </button>
          </div>

          <div class="profile-actions">
            <button mat-stroked-button
                    color="warn"
                    class="logout-button"
                    (click)="signOut()">
              <mat-icon>logout</mat-icon>
              {{ 'PROFILE.ACTIONS.SIGN_OUT' | translate }}
            </button>

            <button mat-stroked-button
                    color="warn"
                    class="delete-button"
                    (click)="openDeleteAccountDialog()">
              <mat-icon>delete_forever</mat-icon>
              {{ 'PROFILE.ACTIONS.DELETE_ACCOUNT' | translate }}
            </button>
          </div>
        </div>
      </div>

      <!-- Contenido principal con tabs -->
      <div class="profile-main">
        <mat-tab-group animationDuration="200ms" class="profile-tabs">
          <!-- Tab: Información Personal -->
          <mat-tab label="{{ 'PROFILE.TABS.PERSONAL_INFO' | translate }}">
            <div class="tab-content">
              <div class="section-header">
                <h3>{{ 'PROFILE.TABS.PERSONAL_INFO' | translate }}</h3>
                <button *ngIf="!isEditingProfile"
                        mat-button
                        (click)="enableProfileEditing()"
                        class="edit-button">
                  <mat-icon>edit {{ 'PROFILE.EDIT.EDIT_BUTTON' | translate }}</mat-icon>
                  Editar
                </button>
              </div>

              <div *ngIf="!isEditingProfile; else editingForm" class="profile-display">
                <div class="info-grid">
                  <div class="info-item">
                    <label>{{ 'PROFILE.EDIT.FULL_NAME' | translate }}</label>
                    <span>{{ profile.fullName }}</span>
                  </div>

                  <div class="info-item">
                    <label>{{ 'PROFILE.EDIT.EMAIL' | translate }}</label>
                    <span>{{ email }}</span>
                  </div>

                  <div class="info-item">
                    <label>{{ 'PROFILE.EDIT.PHONE' | translate }}</label>
                    <span>{{ profile.phoneNumber || ('PROFILE.EDIT.NOT_SPECIFIED' | translate) }}</span>
                  </div>

                  <div class="info-item">
                    <label>{{ 'PROFILE.EDIT.ADDRESS' | translate }}</label>
                    <span>{{ profile.streetAddress || ('PROFILE.EDIT.NOT_SPECIFIED' | translate) }}</span>
                  </div>
                </div>

                <div class="security-section">
                  <h4>{{ 'PROFILE.EDIT.CHANGE_PASSWORD' | translate }}</h4>
                  <button mat-button
                          (click)="openChangePasswordDialog()"
                          class="security-button">
                    <mat-icon>lock</mat-icon>
                    {{ 'PROFILE.EDIT.CHANGE_PASSWORD' | translate }}
                  </button>
                </div>
              </div>

              <ng-template #editingForm>
                <app-profile-form
                  [profile]="profile"
                  [editMode]="true"
                  [isLoading]="isLoading"
                  (profileSubmit)="updateProfile($event)"
                  (cancel)="cancelEditing()">
                </app-profile-form>
              </ng-template>
            </div>
          </mat-tab>

          <!-- Tab: Notificaciones -->
          <mat-tab label="{{ 'PROFILE.TABS.NOTIFICATIONS' | translate }}">
            <div class="tab-content">
              <h3>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.TITLE' | translate }}</h3>
              <p class="section-description">
                {{ 'PROFILE.NOTIFICATIONS_SETTINGS.DESCRIPTION' | translate }}
              </p>

              <div class="notification-settings">

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.SENSOR_ALERTS' | translate }}</h4>
                    <p>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.SENSOR_ALERTS_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="true"></mat-slide-toggle>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.WEEKLY_REPORTS' | translate }}</h4>
                    <p>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.WEEKLY_REPORTS_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="false"></mat-slide-toggle>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.EMAIL_NOTIFICATIONS' | translate }}</h4>
                    <p>{{ 'PROFILE.NOTIFICATIONS_SETTINGS.EMAIL_NOTIFICATIONS_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="true"></mat-slide-toggle>
                </div>
              </div>
            </div>
          </mat-tab>

          <!-- Tab: Privacidad -->
          <mat-tab label="{{ 'PROFILE.TABS.PRIVACY' | translate }}">
            <div class="tab-content">
              <h3>{{ 'PROFILE.PRIVACY_SETTINGS.TITLE' | translate }}</h3>
              <p class="section-description">
                {{ 'PROFILE.PRIVACY_SETTINGS.DESCRIPTION' | translate }}
              </p>

              <div class="privacy-settings">
                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.PRIVACY_SETTINGS.PUBLIC_PROFILE' | translate }}</h4>
                    <p>{{ 'PROFILE.PRIVACY_SETTINGS.PUBLIC_PROFILE_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="false"></mat-slide-toggle>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.PRIVACY_SETTINGS.SHARE_PLANT_DATA' | translate }}</h4>
                    <p>{{ 'PROFILE.PRIVACY_SETTINGS.SHARE_PLANT_DATA_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="true"></mat-slide-toggle>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>{{ 'PROFILE.PRIVACY_SETTINGS.USAGE_ANALYTICS' | translate }}</h4>
                    <p>{{ 'PROFILE.PRIVACY_SETTINGS.USAGE_ANALYTICS_DESC' | translate }}</p>
                  </div>
                  <mat-slide-toggle color="primary" [checked]="true"></mat-slide-toggle>
                </div>
              </div>

              <div class="data-management">
                <h4>{{ 'PROFILE.PRIVACY_SETTINGS.DATA_MANAGEMENT' | translate }}</h4>
                <div class="data-actions">
                  <button mat-button class="data-button">
                    <mat-icon>download</mat-icon>
                    {{ 'PROFILE.PRIVACY_SETTINGS.DOWNLOAD_DATA' | translate }}
                  </button>
                  <button mat-button color="warn" class="data-button">
                    <mat-icon>delete_sweep</mat-icon>
                    {{ 'PROFILE.PRIVACY_SETTINGS.DELETE_DATA' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>

  <ng-template #loading>
    <div class="loading-container">
      <mat-icon class="loading-icon">person</mat-icon>
      <p>Cargando perfil...</p>
    </div>
  </ng-template>

  <div *ngIf="errorMessage" class="error-message">
    <mat-icon>error_outline</mat-icon>
    <p>{{ errorMessage }}</p>
  </div>
</div>
